---
  name: e-commerce workflow 
  on:
    push:
      branches:
        - main

  jobs:
    unit-testing:
      name: Unit Testing
      runs-on: ubuntu-latest
      container: node:18
      steps:
        - name: Checkout Repository
          uses: actions/checkout@v4

        - name: Cache NPM dependencies
          uses: actions/cache@v4
          with:
            path: ~/.npm
            key: '${{ runner.os }}-node-modules-${{ hashFiles(''package-lock.json'') }}'


        - name: Install Dependencies
          run: npm install

    docker:
      name: docker-build
      needs: unit-testing
      runs-on: ubuntu-latest
      steps:
        - name: checkout repo
          uses: actions/checkout@v4.2.2

        - name: DockerLogin
          uses: docker/login-action@v3.4.0
          with:
            username: ${{ vars.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}

        - name: Build and push Docker images
          uses: docker/build-push-action@v6.18.0
          with:
            push: true
            tags: soewailin/cake-e-commerce:v1.0.11
            context: .
      